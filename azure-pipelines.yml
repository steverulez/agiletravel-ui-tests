# Ruby
# Package your Ruby project.
# Add steps that install rails, analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/ruby

variables:
  BUNDLE_PATH: $(Pipeline.Workspace)/.bundle

trigger:
- master

strategy:
  matrix:
    linux-chrome:
      imageName: 'windows-latest'
      browser: chrome

pool:
  vmImage: $(imageName)

steps:
- task: UseRubyVersion@0
  inputs:
    versionSpec: '>= 2.5'

- task: Cache@2
  inputs:
    key: 'gems | "$(Agent.OS)" | my.gemspec'
    restoreKeys: | 
       gems | "$(Agent.OS)"
       gems
    path: $(BUNDLE_PATH)
  displayName: Cache gems


- script: |
    gem install bundler
    bundle install --retry=3 --jobs=4 --gemfile=selenium-webdriver-rspec/Gemfile
  displayName: 'bundle install'

- script: bundle exec rake -f Rakefile ci:ui_tests:quick
  displayName: 'bundle exec rake'
  workingDirectory: selenium-webdriver-rspec
